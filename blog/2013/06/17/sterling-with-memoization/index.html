
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	
	<title>Sterling With Memoization | Logan McGrath's Blog</title>
	

	<meta name="author" content="Logan McGrath">
	
	<meta name="description" content="In my last post I wrote about performance in the
Sterling programming language with a basic benchmark. Today I&rsquo;m ticking off one
@TODO item: &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/rss.xml" rel="alternate" title="Logan McGrath's Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

	<script type="text/javascript" src="/javascripts/libs/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Logan McGrath's Blog</a></h1>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about-me">About</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>


</header>
	<div id="main" class="inner">
		<div id="content"><article class="post">
	<h2 class="title">Sterling With Memoization</h2>
	<div class="entry-content"><p>In my <a href="/blog/2013/06/16/sterling-benchmarks/">last post</a> I wrote about performance in the
<a href="https://github.com/lmcgrath/sterling">Sterling</a> programming language with a basic benchmark. Today I&rsquo;m ticking off one
<strong>@TODO</strong> item: <a href="https://en.wikipedia.org/wiki/Memoization">Memoization</a>.</p>

<!--more-->


<p>Sterling now stores the results of each function/argument pair, returning respective results rather than forcing a
recalculation of an already-known value. I&rsquo;ve leveraged the benchmark from the previous post, and the difference in
execution speed is very pronounced:</p>

<figure class='code'><figcaption><span>The Results</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Java Benchmark
</span><span class='line'>--------------
</span><span class='line'>Iteration 0: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 6 milliseconds
</span><span class='line'>Iteration 1: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 2: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 3: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 4: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 5: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 6: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 7: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 8: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 9: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>--------------
</span><span class='line'>Average <span class="k">for </span>10 iterations X 100 executions: 4 milliseconds
</span><span class='line'>
</span><span class='line'>Sterling Benchmark
</span><span class='line'>------------------
</span><span class='line'>Iteration 0: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 648 milliseconds
</span><span class='line'>Iteration 1: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 2: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 1 milliseconds
</span><span class='line'>Iteration 3: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 4: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 5: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 6: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 7: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 8: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 9: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>------------------
</span><span class='line'>Average <span class="k">for </span>10 iterations X 100 executions: 64 milliseconds
</span></code></pre></td></tr></table></div></figure>


<p>Sterling without memoization required on average 0.079 seconds to calculate the 20th member of the Fibonacci sequence,
but with memoization, the amount of time shrinks to 0.006 seconds. The time penalty only applies the first time the
function is executed for a given argument, so call times become near-instantaneous.</p>

<h2>Sterling is faster than Java!</h2>

<p><strong>Not really.</strong> But it is if I fiddle with the benchmark variables a bit (:</p>

<p>By changing the benchmark to execute the Fibonacci function 1000 times for 100 iterations, something interesting
happens:</p>

<figure class='code'><figcaption><span>Fiddling with the benchmark</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Java Benchmark
</span><span class='line'>--------------
</span><span class='line'>Iteration 0: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 42 milliseconds
</span><span class='line'>Iteration 1: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 39 milliseconds
</span><span class='line'>Iteration 2: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 38 milliseconds
</span><span class='line'>Iteration 3: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 39 milliseconds
</span><span class='line'>Iteration 4: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 39 milliseconds
</span><span class='line'>Iteration 5: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 39 milliseconds
</span><span class='line'>Iteration 6: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 41 milliseconds
</span><span class='line'>Iteration 7: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 40 milliseconds
</span><span class='line'>Iteration 8: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 38 milliseconds
</span><span class='line'>Iteration 9: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 38 milliseconds
</span><span class='line'>...
</span><span class='line'>Iteration 99: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 39 milliseconds
</span><span class='line'>--------------
</span><span class='line'>Average <span class="k">for </span>100 iterations X 1000 executions: 39 milliseconds
</span><span class='line'>
</span><span class='line'>Sterling Benchmark
</span><span class='line'>------------------
</span><span class='line'>Iteration 0: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 629 milliseconds
</span><span class='line'>Iteration 1: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 2: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 3: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 4: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 5: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 6: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 7: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>Iteration 8: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 1 milliseconds
</span><span class='line'>Iteration 9: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>...
</span><span class='line'>Iteration 99: <span class="nv">executions</span> <span class="o">=</span> 1000; <span class="nv">elapsed</span> <span class="o">=</span> 0 milliseconds
</span><span class='line'>------------------
</span><span class='line'>Average <span class="k">for </span>100 iterations X 1000 executions: 6 milliseconds
</span></code></pre></td></tr></table></div></figure>


<h3>This benchmark smells funny</h3>

<p>Yes, the performance in this benchmark is very contrived. But this does present an interesting potential property of
applications written in Sterling: If an application performs a great deal of repeated calculations, it will run faster
over time. A quick glance at the second bench mark will show that Java is performing the calculation every single time
it is called, whereas Sterling only requires the first call and then it stores the result. This suggests <strong>O(1)</strong> vs.
<strong>O(n)</strong> time complexity in Sterling&rsquo;s favor.</p>

<p>You won&rsquo;t get this sort of performance for a web application because of their side effect-driven nature, but for number
crunching Sterling may very well be a good idea.</p>

<h2>@TODO</h2>

<h3>How does memoization impact memory?</h3>

<p>Obviously, those calculated values get stored somewhere, and somewhere means memory is being used. I should perform
another benchmark comparing memory requirements of the Fibonacci algorithm between pure Java and Sterling.</p>

<h3>What if I don&rsquo;t want memoization for a particular function?</h3>

<p>There may be some cases where you want to recalculate a value for a known argument. For example, if I query a database
I shouldn&rsquo;t necessarily  expect the same result each time. Sterling should give an easy way of signalling that a
function should not leverage memoization.</p>

<h2>Links</h2>

<ul>
<li><a href="https://github.com/lmcgrath/sterling/commit/7d69d49a911d2d916701fa973e02ffabe82afe9d">Commit containing memoization changes</a></li>
<li><a href="https://github.com/lmcgrath/sterling/blob/5c879ece28194fdbc36ed5dff2a760d6a38a4033/src/test/java/sterling/math/FibonacciBenchmarkTest.java">Benchmark showing O(1) complexity</a></li>
</ul>

</div>


<div class="meta">
	<div class="date">










<time datetime="2013-06-17T04:26:00-07:00" pubdate data-updated="true">Jun 17<span>th</span>, 2013</time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/functional-programming/'>Functional Programming</a>, <a class='category' href='/blog/categories/language-design/'>Language Design</a>, <a class='category' href='/blog/categories/sterling/'>Sterling</a>

</div>


</div>
</article>
</div>
		<aside class="sidebar">
			
				<section>
  <h2>Recent Posts</h2>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/08/05/lessons-from-sterling/">Lessons From Sterling</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/17/sterling-with-memoization/">Sterling With Memoization</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/16/sterling-benchmarks/">Sterling Benchmarks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/28/promoting-changes-with-app-config-app/">Promoting Changes With App-Config-App</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/20/app-config-app-in-action/">App-Config-App in Action</a>
      </li>
    
  </ul>
</section>

<section>
  <h2>GitHub Repos</h2>
  <ul id="gh_repos">
    <li class="loading">Loading repositories...</li>
  </ul>
  
  <p class="github-username"><a href="https://github.com/lmcgrath">@lmcgrath</a> on GitHub</p>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'lmcgrath',
            count: 5,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"></script>
</section>





			
		</aside>
		<div class="clearfix"></div>
	</div>
	<footer id="footer" class="inner">Copyright &copy; 2015
 Logan McGrath 
<br>
Powered by Octopress.
</footer>
	

</body>
</html>
