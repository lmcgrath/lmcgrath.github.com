
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sterling Benchmarks - Logan McGrath's Blog</title>
  <meta name="author" content="Logan McGrath">

  
  <meta name="description" content="Since mid January, I’ve been
developing a functional scripting language I call Sterling. In the past few
weeks, Sterling has become nearly usable, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://loganmcgrath.com/blog/2013/06/16/sterling-benchmarks">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/rss.xml" rel="alternate" title="Logan McGrath's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36481003-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Logan McGrath's Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/rss.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:loganmcgrath.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about-me.html">About Me</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Sterling Benchmarks</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-16T21:12:00-05:00" pubdate data-updated="true">Jun 16<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Since <a href="https://github.com/lmcgrath/sterling/tree/8b58ce4d4b080b353f7870ec0c0c30639fb2fa7b">mid January</a>, I’ve been
developing a functional scripting language I call <a href="https://github.com/lmcgrath/sterling">Sterling</a>. In the past few
weeks, Sterling has become nearly usable, but it doesn’t seem to be very fast. So this weekend, I’ve taking the time to
create a simple (read: na&iuml;ve) benchmark.</p>

<p>The benchmark uses a <a href="http://en.wikipedia.org/wiki/Dynamic_programming#Fibonacci_sequence">recursive algorithm</a> to
calculate the Nth member of the <a href="http://en.wikipedia.org/wiki/Fibonacci_sequence">Fibonacci sequence</a>. I’ve implemented
both Sterling and Java versions of the algorithm and I will be benchmarking each for comparison.</p>

<figure class='code'><figcaption><span>Sterling Implementation</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">fibonacci</span> <span class="ow">=</span> <span class="n">n</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="n">n</span> <span class="ow">=</span> <span class="mi">0</span> <span class="kr">then</span> <span class="mi">0</span>
</span><span class='line'>                 <span class="kr">else</span> <span class="kr">if</span> <span class="n">n</span> <span class="ow">=</span> <span class="mi">1</span> <span class="kr">then</span> <span class="mi">1</span>
</span><span class='line'>                 <span class="kr">else</span> <span class="n">fibonacci</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Java Implementation</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">static</span> <span class="kt">int</span> <span class="nf">fibonacci</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">fibonacci</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Why was the Fibonacci sequence chosen for the benchmark?</h3>

<p>The algorithm for calculating the Nth member of the Fibonacci sequence has two key traits:</p>

<ul>
<li>It’s recursive</li>
<li>It has O(2<sup>n</sup>) complexity</li>
</ul>


<p>Sterling as of right now performs zero optimizations, so I’m assuming this algorithm will bring out Sterling’s
worst performance characteristics (muahahaha).</p>

<h2>The benchmark execution plan</h2>

<p>I’m using a very basic benchmark excluding Sterling’s compilation overhead and comparing the results to native Java. I
will execute the Fibonacci algorithm 100 times for 10 iterations, providing an average of the time elapsed for each
iteration.</p>

<figure class='code'><figcaption><span>Benchmark Pseudo-Java&trade;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Expression</span> <span class="n">input</span> <span class="o">=</span> <span class="n">IntegerConstant</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
</span><span class='line'><span class="n">Expression</span> <span class="n">sterlingFibonacci</span> <span class="o">=</span> <span class="n">load</span><span class="o">(</span><span class="s">&quot;sterling/math/fibonacci&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">javaBenchmark</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Interval</span><span class="o">&gt;</span> <span class="n">intervals</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="n">iterations</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">currentTimeMillis</span><span class="o">();</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">:</span> <span class="n">executions</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">fibonacci</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">intervals</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">);</span>
</span><span class='line'>        <span class="n">printIteration</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">intervals</span><span class="o">.</span><span class="na">last</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">printAverage</span><span class="o">(</span><span class="n">intervals</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">sterlingBenchmark</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Interval</span><span class="o">&gt;</span> <span class="n">intervals</span><span class="o">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="n">iterations</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">currentTimeMillis</span><span class="o">();</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">:</span> <span class="n">executions</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">sterlingFibonacci</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="na">evaluate</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">intervals</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">);</span>
</span><span class='line'>        <span class="n">printIteration</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">intervals</span><span class="o">.</span><span class="na">last</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">printAverage</span><span class="o">(</span><span class="n">intervals</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The benchmark results</h2>

<figure class='code'><figcaption><span>The Results</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Java Benchmark
</span><span class='line'>--------------
</span><span class='line'>Iteration 0: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 1: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 2: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 3: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 4: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 5: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 6: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 7: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 8: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>Iteration 9: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 4 milliseconds
</span><span class='line'>--------------
</span><span class='line'>Average <span class="k">for </span>10 iterations X 100 executions: 4 milliseconds
</span><span class='line'>
</span><span class='line'>Sterling Benchmark
</span><span class='line'>------------------
</span><span class='line'>Iteration 0: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 8,152 milliseconds
</span><span class='line'>Iteration 1: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 7,834 milliseconds
</span><span class='line'>Iteration 2: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 7,873 milliseconds
</span><span class='line'>Iteration 3: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 7,873 milliseconds
</span><span class='line'>Iteration 4: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 7,910 milliseconds
</span><span class='line'>Iteration 5: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 7,973 milliseconds
</span><span class='line'>Iteration 6: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 7,927 milliseconds
</span><span class='line'>Iteration 7: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 7,793 milliseconds
</span><span class='line'>Iteration 8: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 7,912 milliseconds
</span><span class='line'>Iteration 9: <span class="nv">executions</span> <span class="o">=</span> 100; <span class="nv">elapsed</span> <span class="o">=</span> 7,986 milliseconds
</span><span class='line'>------------------
</span><span class='line'>Average <span class="k">for </span>10 iterations X 100 executions: 7,923 milliseconds
</span></code></pre></td></tr></table></div></figure>


<h3>Immediate conclusions:</h3>

<p>Sterling is <em><strong>REALLY</strong></em> slow!</p>

<p>Sterling executes directly against an abstract syntax tree representing operations and data. This tree is generally
immutable, so the execution is performed by effectively rewriting the tree to reduce each node into an “atomic”
expression, such as an integer constant or lambda (which can’t be further reduced without an applied argument).</p>

<p>References to functions are inserted into the tree by copying the function’s tree into the reference’s node. The
function is then evaluated with a given argument to reduce the tree to a single node. These copy-and-reduce operations
are very costly and are a likely reason for Sterling’s poor performance.</p>

<h2>@TODO</h2>

<h3>Memoization</h3>

<p>Copying and reducing a function tree for an argument is expensive. These operations should not need to be performed
more than once for any function and argument pair.</p>

<h3>Bytecode perhaps?</h3>

<p>Given the shear amount of recursion and method calls being performed to execute Sterling, does it makes sense to
compile the syntax tree into a bytecode that can be executed in a loop?</p>

<h2>Links</h2>

<ul>
<li><a href="https://github.com/lmcgrath/sterling">Sterling GitHub Project</a></li>
<li><a href="https://github.com/lmcgrath/sterling/blob/post_20130616_sterling_benchmark/src/test/java/sterling/math/FibonacciBenchmarkTest.java">Benchmark Code</a></li>
<li><a href="https://github.com/lmcgrath/sterling/blob/post_20130616_sterling_benchmark/src/main/resources/sterling/math/_base.ag">Sterling Fibonacci Implementation</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Logan McGrath</span></span>

      








  


<time datetime="2013-06-16T21:12:00-05:00" pubdate data-updated="true">Jun 16<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/functional-programming/'>Functional Programming</a>, <a class='category' href='/blog/categories/language-design/'>Language Design</a>, <a class='category' href='/blog/categories/sterling/'>Sterling</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://loganmcgrath.com/blog/2013/06/16/sterling-benchmarks/" data-via="" data-counturl="http://loganmcgrath.com/blog/2013/06/16/sterling-benchmarks/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/11/28/promoting-changes-with-app-config-app/" title="Previous Post: Promoting changes with App-Config-App">&laquo; Promoting changes with App-Config-App</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/06/17/sterling-with-memoization/" title="Next Post: Sterling With Memoization">Sterling With Memoization &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/06/17/sterling-with-memoization/">Sterling With Memoization</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/16/sterling-benchmarks/">Sterling Benchmarks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/28/promoting-changes-with-app-config-app/">Promoting Changes With App-Config-App</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/20/app-config-app-in-action/">App-Config-App in Action</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/16/scm-backed-application-configuration-with-perforce/">SCM-Backed Application Configuration With Perforce</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Logan McGrath -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
