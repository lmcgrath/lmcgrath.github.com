
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Lessons from Sterling - Logan McGrath's Blog</title>
  <meta name="author" content="Logan McGrath">

  
  <meta name="description" content="I&rsquo;ve spent the last seven months developing a language called Sterling.
Sterling was intended to be an untyped functional scripting language, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://loganmcgrath.com/blog/2013/08/05/lessons-from-sterling">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/rss.xml" rel="alternate" title="Logan McGrath's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36481003-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Logan McGrath's Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/rss.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:loganmcgrath.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about-me.html">About Me</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Lessons From Sterling</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-05T09:37:00-07:00" pubdate data-updated="true">Aug 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&rsquo;ve spent the last seven months developing a language called <a href="https://github.com/lmcgrath/sterling">Sterling</a>.
Sterling was intended to be an untyped functional scripting language, something like lazily-evaluated, immutable
JavaScript. Last week I decided to shelve Sterling.</p>

<h2>How Sterling Worked</h2>

<p>Sterling&rsquo;s evaluation model is very simple and I felt it held a lot of promise because it made the language very
flexible. Everything in Sterling is an expression. Some expressions accept a single argument&mdash;these were called
<em>lambdas</em>. All expressions also contain sub-expressions, which could be accessed as <em>attributes</em>. With a little sugar,
a bag of attributes could be made self-referencing and thus become an <em>object</em>.</p>

<figure class='code'><figcaption><span>An assortment of basic expression types</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="o">//</span> <span class="n">a</span> <span class="n">constant</span> <span class="n">expression</span> <span class="n">which</span> <span class="n">takes</span> <span class="n">no</span> <span class="n">arguments</span>
</span><span class='line'><span class="nf">anExpression</span> <span class="ow">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>
</span><span class='line'>
</span><span class='line'><span class="o">//</span> <span class="n">lambda</span> <span class="n">expressions</span> <span class="n">take</span> <span class="n">only</span> <span class="mi">1</span> <span class="n">argument</span>
</span><span class='line'><span class="nf">aLambda</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x</span>
</span><span class='line'>
</span><span class='line'><span class="o">//</span> <span class="n">function</span> <span class="n">expressions</span> <span class="n">take</span> <span class="n">more</span> <span class="n">than</span> <span class="mi">1</span> <span class="n">argument</span>
</span><span class='line'><span class="nf">aFunction</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
</span><span class='line'>
</span><span class='line'><span class="o">//</span> <span class="n">an</span> <span class="n">object</span> <span class="n">expression</span> <span class="n">with</span> <span class="n">constructor</span>
</span><span class='line'><span class="nf">anObject</span> <span class="ow">=</span> <span class="p">(</span><span class="n">constructorArg</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">madeWith</span><span class="kt">:</span> <span class="n">constructorArg</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">//</span> <span class="n">an</span> <span class="n">object</span> <span class="n">expression</span> <span class="n">that</span> <span class="n">behaves</span> <span class="n">like</span> <span class="n">a</span> <span class="n">lambda</span> <span class="n">after</span> <span class="n">constructed</span>
</span><span class='line'><span class="nf">invokableObject</span> <span class="ow">=</span> <span class="p">(</span><span class="n">constructorArg</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">madeWith</span><span class="kt">:</span> <span class="n">constructorArg</span><span class="p">,</span>
</span><span class='line'>    <span class="n">invoke</span><span class="kt">:</span> <span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="s">&quot;Made with #{self.madeWith} and invoked with #{arg}&quot;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Expressions could be built up to carry a high amount of capability. Because Sterling is untyped, decoration and
ducktyping are used heavily to compose ever more features into expressions.</p>

<p>Sterling was directly inspired by <a href="http://en.wikipedia.org/wiki/Lambda_calculus">Lambda Calculus</a>. This had an enormous
impact on the design of the language, the largest of which was how the language executed at runtime. Expressions in
Sterling are represented as trees and leaves. Top-level expressions have names, and they could be inserted into other
expressions by referencing those names.</p>

<figure class='code'><figcaption><span>A recursive named expression looks like this:</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">fibonacci</span> <span class="ow">=</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="kr">then</span>
</span><span class='line'>                       <span class="n">n</span>
</span><span class='line'>                   <span class="kr">else</span>
</span><span class='line'>                       <span class="n">fibonacci</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>                   <span class="n">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Because each expression was a tree, no expression needed to be executed until its result was absolutely needed. This
lazy execution model allows for very large, complex expressions to be built in one function then returned to the
outside world to be further processed and executed. Functions could be created inline and passed as arguments to other
functions, or constructed within functions and returned.</p>

<p>Sterling&rsquo;s tree-based structure naturally supported a prototype-based object model. To modify an expression tree, the
tree needed to create a copy of itself with any changes to it. All expressions, thus, were effective prototypes. This
also had the benefit of directly supporting immutability and helped to enforce a functional programming paradigm.</p>

<h2>What Could Have Been</h2>

<p>I intended Sterling to be a functional scripting language. In some ways, I was looking to create a JavaScript reboot
that clung closer to JavaScript&rsquo;s functional roots and would be used for general-purpose scripting.</p>

<p>Sterling&rsquo;s syntax was designed to be very terse, readable, and orthogonal. By that I mean everything in Sterling should
be an expression that can be used <a href="http://brandonbyars.com/2008/07/21/orthogonality/">virtually anywhere for anything</a>.
Because Sterling was based on lambdas, this worked particularly well for arguments expressions because arguments could
fold into the function call result on the left:</p>

<figure class='code'><figcaption><span>Consing a list by folding arguments, left-to-write</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kt">[]</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>
</span><span class='line'><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>
</span><span class='line'><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="mi">3</span> <span class="mi">4</span>
</span><span class='line'><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">4</span>
</span><span class='line'><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This folding capability meant that Sterling could support very expressive programming styles. Any function could be
returned as the result of another function call and continue chaining against arguments. Sterling&rsquo;s terse syntax also
made defining functions very easy:</p>

<figure class='code'><figcaption><span>Some basic functions in Sterling</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">identity</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">x</span>
</span><span class='line'><span class="nf">selfApply</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="n">x</span>
</span><span class='line'><span class="nf">apply</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="n">y</span>
</span><span class='line'><span class="nf">selectFirst</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">x</span>
</span><span class='line'><span class="nf">selectSecond</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">y</span>
</span><span class='line'><span class="nf">conditional</span> <span class="ow">=</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="n">condition</span><span class="o">.</span><span class="n">true</span><span class="o">?</span> <span class="kr">then</span> <span class="n">selectFirst</span> <span class="kr">else</span> <span class="n">selectSecond</span> <span class="n">end</span>
</span><span class='line'><span class="nf">friday</span><span class="o">?</span> <span class="ow">=</span> <span class="n">say</span> <span class="o">$</span> <span class="n">conditional</span> <span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">is</span> <span class="kt">:</span><span class="n">friday</span><span class="p">)</span> <span class="sc">&#39;Yay Friday!&#39;</span> <span class="sc">&#39;Awww...&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Because Sterling was intended to be immutable, objects would be used to represent state and carry behavior to return
new state resulting from an operation:</p>

<figure class='code'><figcaption><span>Printing arguments from an immutable list iterator</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="ow">-&gt;</span>
</span><span class='line'>    <span class="n">print</span> <span class="n">args</span><span class="o">.</span><span class="n">iterator</span> <span class="o">//</span> <span class="n">gets</span> <span class="n">an</span> <span class="kt">Iterator</span>
</span><span class='line'>
</span><span class='line'><span class="nf">print</span> <span class="ow">=</span> <span class="p">(</span><span class="n">iterator</span><span class="p">)</span> <span class="ow">-&gt;</span>
</span><span class='line'>    <span class="n">say</span> <span class="n">unless</span> <span class="n">iterator</span><span class="o">.</span><span class="n">empty</span><span class="o">?</span> <span class="kr">then</span>
</span><span class='line'>        <span class="n">printNext</span> <span class="n">iterator</span> <span class="mi">0</span>
</span><span class='line'>    <span class="kr">else</span>
</span><span class='line'>        <span class="sc">&#39;Empty iterator&#39;</span>
</span><span class='line'>    <span class="n">end</span>
</span><span class='line'>
</span><span class='line'><span class="nf">printNext</span> <span class="ow">=</span> <span class="p">(</span><span class="n">iterator</span> <span class="n">index</span><span class="p">)</span> <span class="ow">-&gt;</span>
</span><span class='line'>    <span class="n">unless</span> <span class="n">iterator</span><span class="o">.</span><span class="n">empty</span><span class="o">?</span> <span class="kr">then</span>
</span><span class='line'>        <span class="s">&quot;arg #{index} =&gt; #{iterator.current}</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">printNext</span> <span class="n">iterator</span><span class="o">.</span><span class="n">tail</span> <span class="n">index</span><span class="o">.</span><span class="n">up</span>
</span><span class='line'>    <span class="n">end</span>
</span><span class='line'>
</span><span class='line'><span class="kt">Iterator</span> <span class="ow">=</span> <span class="p">(</span><span class="n">elements</span> <span class="n">position</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">empty</span><span class="o">?:</span> <span class="n">position</span> <span class="o">&gt;=</span> <span class="n">elements</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>
</span><span class='line'>    <span class="n">head</span><span class="kt">:</span> <span class="kt">Iterator</span> <span class="n">elements</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="n">current</span><span class="kt">:</span> <span class="n">elements</span><span class="p">[</span><span class="n">position</span><span class="p">],</span>
</span><span class='line'>    <span class="n">tail</span><span class="kt">:</span> <span class="n">iterator</span> <span class="n">elements</span> <span class="n">position</span><span class="o">.</span><span class="n">up</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Paul Hammant at one point suggested baking dependency injection <a href="http://paulhammant.com/blog/crazy-bob-and-type-safety-for-dependency-injection.html/">directly into a language</a>,
and even offered I do this in Sterling. This drove development of a metadata system in Sterling that could be used to
support metaprogramming and eventually dependency injection.</p>

<figure class='code'><figcaption><span>Meta attributes on expressions</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="o">@</span><span class="n">component</span> <span class="p">{</span> <span class="n">uses</span><span class="kt">:</span> <span class="p">[</span> <span class="kt">:</span><span class="n">productionDb</span> <span class="p">]</span> <span class="p">}</span>
</span><span class='line'><span class="o">@</span><span class="n">useWhen</span> <span class="p">(</span><span class="n">runtime</span> <span class="ow">-&gt;</span> <span class="n">runtime</span><span class="o">.</span><span class="n">env</span> <span class="n">is</span> <span class="kt">:</span><span class="n">production</span><span class="p">)</span>
</span><span class='line'><span class="kt">Inventory</span> <span class="ow">=</span> <span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">numberOfItems</span><span class="kt">:</span> <span class="n">db</span><span class="o">.</span><span class="n">asInt</span> <span class="o">$</span> <span class="n">db</span><span class="o">.</span><span class="n">scalarQuery</span> <span class="s">&quot;SELECT COUNT(*) FROM thingies&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">priceCheck</span><span class="kt">:</span> <span class="p">(</span><span class="n">thingy</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">asMoney</span> <span class="o">$</span> <span class="n">db</span><span class="o">.</span><span class="n">scalarQuery</span> <span class="s">&quot;SELECT price FROM thingies WHERE id = :id&quot;</span> <span class="p">{</span> <span class="n">id</span><span class="kt">:</span> <span class="n">thingy</span><span class="o">.</span><span class="n">id</span> <span class="p">},</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">@</span><span class="n">provides</span> <span class="kt">:</span><span class="n">productionDb</span>
</span><span class='line'><span class="nf">createDb</span> <span class="ow">=</span> <span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="o">@</span><span class="n">fake</span><span class="o">?</span> <span class="n">true</span>
</span><span class='line'><span class="o">@</span><span class="n">component</span> <span class="p">{</span> <span class="n">name</span><span class="kt">:</span> <span class="kt">:Inventory</span> <span class="p">}</span>
</span><span class='line'><span class="o">@</span><span class="n">useWhen</span> <span class="p">(</span><span class="n">runtime</span> <span class="ow">-&gt;</span> <span class="n">runtime</span><span class="o">.</span><span class="n">env</span> <span class="n">is</span> <span class="kt">:</span><span class="n">development</span><span class="p">)</span>
</span><span class='line'><span class="kt">FakeInventory</span> <span class="ow">=</span> <span class="n">object</span> <span class="ow">-&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">numberOfItems</span><span class="kt">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="n">priceCheck</span><span class="kt">:</span> <span class="p">(</span><span class="n">thingy</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">thingy</span><span class="o">.</span><span class="n">price</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The metadata system was very flexible and could support arbitrary meta annotations. The above metadata translates to
the following map structures at runtime:</p>

<figure class='code'><figcaption><span>What meta attributes look like if they were JavaScript</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Inventory</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;component&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;uses&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;productionDb&quot;</span> <span class="p">]</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="s2">&quot;useWhen&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">runtime</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">runtime</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;production&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">createDb</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;provides&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;productionDb&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">FakeInventory</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;fake?&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="s2">&quot;component&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Inventory&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="s2">&quot;useWhen&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">runtime</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">runtime</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;development&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>I felt these functional features and expressive syntax would make for an enjoyable and productive programming
experience. The meta system in particular I felt could become quite powerful especially for customizing load-time
behavior of Sterling programs. However, some of my goals came with a few problems.</p>

<h2>The Problems</h2>

<h3>Speed</h3>

<p>Sterling is amazingly slow. A natural consequence of a tree-based language is that trees must be copied and modified
for many operations, no matter how &ldquo;trivial&rdquo; they may be (integer arithmetic, for example.) Recursive functions like
the <code>fibonacci</code> expression above had a particularly nasty characteristic of building enormous trees that took a lot of
time to reduce to single values.</p>

<p>The speed issues in Sterling were partially mitigated using <a href="http://loganmcgrath.com/blog/2013/06/17/sterling-with-memoization/">memoization</a>.</p>

<h3>Memoization: Blessing But Possibly A Curse</h3>

<p>Memoization increased the possibility for static state to hang around in an application. Applying arguments to an
object constructor, for instance, would return a previously-constructed object. I&rsquo;m not entirely sure what the total
impact of the &ldquo;object constructor problem&rdquo; could have been, as objects are not mutable, but I didn&rsquo;t like this
charateristic nonetheless. Immutability, however, wasn&rsquo;t entirely true (see &ldquo;Escaping The Matrix&rdquo; below).</p>

<p>Named expressions are persistent in memory. If a named expression took a large argument, or returned a large result,
then the total memory cost of a memoizing expression could become quite high over time.</p>

<h3>The Impacts Of Typelessness</h3>

<p>Types are actually quite nice to have, and I began to miss them quite a bit the more I worked on Sterling. While
Sterling is very flexible (because it has no types) it also has very poor support for polymorphism (because it has no
types). Want to do something else if you receive an <code>Asteroid</code> object rather than a <code>Spaceship</code> object?</p>

<p>The na&iuml;ve solution is to implement an if-case for each expected type:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kt">Spaceship</span> <span class="ow">=</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">collideWith</span><span class="kt">:</span> <span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">-&gt;</span>
</span><span class='line'>        <span class="kr">if</span> <span class="n">other</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">name</span> <span class="n">is</span> <span class="sc">&#39;Asteroid&#39;</span> <span class="kr">then</span>
</span><span class='line'>            <span class="n">say</span> <span class="sc">&#39;Spaceship collided with an asteroid!&#39;</span>
</span><span class='line'>        <span class="kr">else</span> <span class="kr">if</span> <span class="n">other</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">name</span> <span class="n">is</span> <span class="sc">&#39;Spaceship&#39;</span> <span class="kr">then</span>
</span><span class='line'>            <span class="n">say</span> <span class="sc">&#39;Spaceships collide!&#39;</span>
</span><span class='line'>        <span class="n">end</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">Asteroid</span> <span class="ow">=</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">collideWith</span><span class="kt">:</span> <span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">-&gt;</span>
</span><span class='line'>        <span class="kr">if</span> <span class="n">other</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">name</span> <span class="n">is</span> <span class="sc">&#39;Asteroid&#39;</span> <span class="kr">then</span>
</span><span class='line'>            <span class="n">say</span> <span class="sc">&#39;Asteroids collide!&#39;</span>
</span><span class='line'>        <span class="kr">else</span> <span class="kr">if</span> <span class="n">other</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">name</span> <span class="n">is</span> <span class="sc">&#39;Spaceship&#39;</span> <span class="kr">then</span>
</span><span class='line'>            <span class="n">say</span> <span class="sc">&#39;Asteroid collided with a spaceship!&#39;</span>
</span><span class='line'>        <span class="n">end</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>This is fragile, though, and the code is complex. What&rsquo;s worse, is there&rsquo;s no way to ensure that a method is receiving
an <code>Asteroid</code> and not another object that simply implements its API.  A better solution is to let the colliding object
select the proper method from the object it&rsquo;s colliding with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kt">Spaceship</span> <span class="ow">=</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">collideWith</span><span class="kt">:</span> <span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">collidedWithSpaceship</span> <span class="n">self</span><span class="p">,</span>
</span><span class='line'>    <span class="n">collideWithSpaceship</span><span class="kt">:</span> <span class="p">(</span><span class="n">spaceship</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">say</span> <span class="sc">&#39;Spaceships collide!&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">collideWithAsteroid</span><span class="kt">:</span> <span class="p">(</span><span class="n">asteroid</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">say</span> <span class="sc">&#39;Spaceship collided with an asteroid!&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">Asteroid</span> <span class="ow">=</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">collideWith</span><span class="kt">:</span> <span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">collideWithAsteroid</span> <span class="n">self</span><span class="p">,</span>
</span><span class='line'>    <span class="n">collideWithSpaceship</span><span class="kt">:</span> <span class="p">(</span><span class="n">spaceship</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="sc">&#39;Asteroid collided with a spaceship!&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">collideWithAsteroid</span><span class="kt">:</span> <span class="p">(</span><span class="n">asteroid</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="sc">&#39;Asteroids collide!&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This solution is better. It&rsquo;s also similar to implementing <a href="http://en.wikipedia.org/wiki/Visitor_pattern#Java_example">visitor pattern</a>
in Java. I still don&rsquo;t like it because there&rsquo;s no type safety and adding support for more types requires violating the
<a href="http://en.wikipedia.org/wiki/Open/closed_principle">open/closed principle</a>. For instance, in order for a <code>Bunny</code> to be
correctly collided-with, a <code>collidedWithBunny</code> method must be added to both <code>Spaceship</code> and <code>Asteroid</code>. Developers may
find it easier instead to allow the <code>Bunny</code> to masquerade as an asteroid:</p>

<figure class='code'><figcaption><span>Spaceship-eating Bunny</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kt">Bunny</span> <span class="ow">=</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">collideWith</span><span class="kt">:</span> <span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">collideWithAsteroid</span> <span class="n">self</span><span class="p">,</span> <span class="o">//</span> <span class="n">muahaha</span> <span class="kt">I&#39;m</span> <span class="n">an</span> <span class="n">asteroid</span><span class="o">!</span>
</span><span class='line'>    <span class="n">collidedWithSpaceship</span><span class="kt">:</span> <span class="p">(</span><span class="n">spaceship</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">say</span> <span class="sc">&#39;NOM NOM NOM NOM!&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">collidedWithAsteroid</span><span class="kt">:</span> <span class="p">(</span><span class="n">asteroid</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="o">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This <a href="http://en.wikipedia.org/wiki/Multiple_dispatch#Java">single-dispatch behavior</a> means that for any argument
applied to a method name, the same method will be dispatched. In the case of Java, this is determined by the type of
a method&rsquo;s arguments at compile time. Adding new methods for similarly-typed arguments requires all client code be
recompiled. While Sterling may not have typing, it is still single-dispatch.</p>

<p>The lack of types became particularly painful when implementing arithmetic operations and compile-time analysis was
nearly impossible without collecting a great deal of superfluous metadata.</p>

<h3>Escaping The Matrix</h3>

<p>As I worked on Sterling, I required functionality that wasn&rsquo;t yet directly supportable in the language itself. I solved
this problem using the &ldquo;glue&rdquo; expression that could tie into a Java-based expression:</p>

<figure class='code'><figcaption><span>sterling/collection/_base.ag</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">EmptyIterator</span> <span class="o">=</span> <span class="n">glue</span> <span class="s1">&#39;sterling.lang.builtin.EmptyIterator&#39;</span>
</span><span class='line'><span class="no">List</span> <span class="o">=</span> <span class="n">glue</span> <span class="s1">&#39;sterling.lang.builtin.ListConstructor&#39;</span>
</span><span class='line'><span class="no">Set</span> <span class="o">=</span> <span class="n">glue</span> <span class="s1">&#39;sterling.lang.builtin.SetConstructor&#39;</span>
</span><span class='line'><span class="no">Tuple</span> <span class="o">=</span> <span class="n">glue</span> <span class="s1">&#39;sterling.lang.builtin.TupleConstructor&#39;</span>
</span><span class='line'><span class="no">Map</span> <span class="o">=</span> <span class="n">glue</span> <span class="s1">&#39;sterling.lang.builtin.MapConstructor&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>For short-term problems, this option isn&rsquo;t too bad, but it allows the programmer to escape the immutable &ldquo;Matrix&rdquo; of
Sterling. For example, I implemented Sterling&rsquo;s collections as thin wrappers around Java collections, and allowed them
to be mutable. Actually, a lot of things in Sterling were mutable:</p>

<ul>
<li>Method collections on expressions</li>
<li>Object methods</li>
<li>Maps</li>
<li>Lists</li>
</ul>


<p>This, coupled with memoization, could cause a lot of issues with static state and had the potential to enable a lot of
bad design decisions for programs written in Sterling.</p>

<h2>The Good Parts</h2>

<p>Despite the baggage, there&rsquo;s a few takeaways!</p>

<p>Sterling&rsquo;s syntax is very small and terse. I particularly enjoyed not having to type a lot of parentheses, braces,
commas, and semicolons. Separating arguments by spaces allowed the language read like a book.</p>

<p>Most expressions can be delimited with whitespace alone, and because everything is an expression, objects could be
created inline and if-cases could be used as arguments.</p>

<p>Operators are just methods. Any object or expression can define a &ldquo;+&rdquo; operator and customize what it does. With
polymorphism supported with multi-methods, this can become an incredibly powerful feature.</p>

<p>Sterling also has the ability to define arbitrary metadata on any named expression. This metadata is gathered into a
<code>meta</code> attribute and can be inspected at runtime to support a sort of meta programming.</p>

<h2>What I&rsquo;m Carrying Forward</h2>

<p>I&rsquo;m now working on a new language project that will be borrowing Sterling&rsquo;s syntax. This time, however, I will be using
types. Algebraic data types hold a certain fascination for me, and I&rsquo;m interested in seeing what I can do with them. At
the very least, I do intend on using multi-methods for better polymorphism support.</p>

<p>I don&rsquo;t think I like declaring scope. It&rsquo;s verbose. Or declaring types. That should be restricted to places where it
impacts execution, like function signatures.</p>

<p>While Sterling&rsquo;s meta system didn&rsquo;t really go anywhere, I do intend on carrying it forward as a supplement to algebraic
types. I may even still bake in dependency injection because I hate all the typing required to tie together an
application.</p>

<p>I don&rsquo;t believe I will carry forward mandatory immutability, though I may support some form of &ldquo;immutability by
default&rdquo;.</p>

<p>Sterling&rsquo;s lazy evaluation caused a lot of headaches more than a few times. I&rsquo;ll probably not make any successor
language lazily evaluated because memoization becomes a near requirement in order to make lazy evaluation useful.</p>

<h2>My Holy Grail</h2>

<ul>
<li>A language that is interpreted and optionally compiled either AOT or JIT</li>
<li><a href="http://en.wikipedia.org/wiki/Type_inference">Inferred typing</a> as opposed to <a href="http://en.wikipedia.org/wiki/Nominative_type_system">nominal typing</a></li>
<li>At least psuedo-declarative</li>
<li>Dynamic to some degree</li>
<li>Easy to write, easy to read</li>
<li>Highly composable</li>
<li>Simple closures</li>
<li>First-class functions, if not first-class everything</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Logan McGrath</span></span>

      








  


<time datetime="2013-08-05T09:37:00-07:00" pubdate data-updated="true">Aug 5<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/functional-programming/'>Functional Programming</a>, <a class='category' href='/blog/categories/language-design/'>Language Design</a>, <a class='category' href='/blog/categories/sterling/'>Sterling</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://loganmcgrath.com/blog/2013/08/05/lessons-from-sterling/" data-via="" data-counturl="http://loganmcgrath.com/blog/2013/08/05/lessons-from-sterling/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/06/17/sterling-with-memoization/" title="Previous Post: Sterling With Memoization">&laquo; Sterling With Memoization</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/01/23/scoping-and-thunking-in-let-declarations/" title="Next Post: Scoping And Thunking In Let Declarations">Scoping And Thunking In Let Declarations &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/23/scoping-and-thunking-in-let-declarations/">Scoping and Thunking in Let Declarations</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/05/lessons-from-sterling/">Lessons From Sterling</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/17/sterling-with-memoization/">Sterling With Memoization</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/16/sterling-benchmarks/">Sterling Benchmarks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/28/promoting-changes-with-app-config-app/">Promoting Changes With App-Config-App</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Logan McGrath -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
